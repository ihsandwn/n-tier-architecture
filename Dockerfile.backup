FROM postgres:15-alpine

# Install dcron, bash, curl and create backups directory
RUN apk add --no-cache \
    dcron \
    bash \
    curl && \
    mkdir -p /backups

# Copy backup script and make it executable
COPY scripts/backup-db.sh /usr/local/bin/backup-db.sh
RUN chmod +x /usr/local/bin/backup-db.sh

# Create cron job to run backup daily at 1AM
RUN echo "0 1 * * * /usr/local/bin/backup-db.sh >> /var/log/backup.log 2>&1" | crontab -

# Start crond in foreground
CMD ["crond", "-f", "-l", "2"]
